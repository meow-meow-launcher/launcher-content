import{n as L,i as A}from"./BWoT6vWr.js";import{a as c,A as v,f as _,g as w,b as E,E as y,c as S}from"./pXpWsQCZ.js";import{r as g,m as K,a5 as N,U as T,f as U,o as x,w as B,j as P,i as D,n as I}from"./BH4CL5cc.js";import{u as M}from"./B-qXnbMs.js";import{g as h}from"./FUKBWQwh.js";import{P as R}from"./DGROana5.js";const j=L(()=>g([]));function G(){const n=j();return{add(a){const s=n.value[0];a!==s&&(s==null||s.pause()),n.value=O(n.value,a),n.value.unshift(a)},remove(a){var s;n.value=O(n.value,a),(s=n.value[0])==null||s.resume()}}}function O(n,a){const s=[...n],l=s.indexOf(a);return l!==-1&&s.splice(l,1),s}function H(n){return n.filter(a=>a.tagName!=="A")}const W=K({__name:"FocusScope",props:{loop:{type:Boolean,default:!1},trapped:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["mountAutoFocus","unmountAutoFocus"],setup(n,{emit:a}){const s=n,l=a,{currentRef:k,currentElement:b}=M(),p=g(null),F=G(),m=N({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}});T(t=>{if(!A)return;const e=b.value;if(!s.trapped)return;function o(i){if(m.paused||!e)return;const d=i.target;e.contains(d)?p.value=d:c(p.value,{select:!0})}function f(i){if(m.paused||!e)return;const d=i.relatedTarget;d!==null&&(e.contains(d)||c(p.value,{select:!0}))}function u(i){e.contains(p.value)||c(e)}document.addEventListener("focusin",o),document.addEventListener("focusout",f);const r=new MutationObserver(u);e&&r.observe(e,{childList:!0,subtree:!0}),t(()=>{document.removeEventListener("focusin",o),document.removeEventListener("focusout",f),r.disconnect()})}),T(async t=>{const e=b.value;if(await I(),!e)return;F.add(m);const o=h();if(!e.contains(o)){const u=new CustomEvent(v,y);e.addEventListener(v,r=>l("mountAutoFocus",r)),e.dispatchEvent(u),u.defaultPrevented||(_(H(w(e)),{select:!0}),h()===o&&c(e))}t(()=>{e.removeEventListener(v,i=>l("mountAutoFocus",i));const u=new CustomEvent(E,y),r=i=>{l("unmountAutoFocus",i)};e.addEventListener(E,r),e.dispatchEvent(u),setTimeout(()=>{u.defaultPrevented||c(o??document.body,{select:!0}),e.removeEventListener(E,r),F.remove(m)},0)})});function C(t){if(!s.loop&&!s.trapped||m.paused)return;const e=t.key==="Tab"&&!t.altKey&&!t.ctrlKey&&!t.metaKey,o=h();if(e&&o){const f=t.currentTarget,[u,r]=S(f);u&&r?!t.shiftKey&&o===r?(t.preventDefault(),s.loop&&c(u,{select:!0})):t.shiftKey&&o===u&&(t.preventDefault(),s.loop&&c(r,{select:!0})):o===f&&t.preventDefault()}}return(t,e)=>(x(),U(D(R),{ref_key:"currentRef",ref:k,tabindex:"-1","as-child":t.asChild,as:t.as,onKeydown:C},{default:B(()=>[P(t.$slots,"default")]),_:3},8,["as-child","as"]))}});export{W as _};
