import{i as b,o as g}from"./BWoT6vWr.js";import{h as L}from"./ChOKVcqp.js";import{r as m,U as O,n as h,m as B,a5 as T,l as y,f as F,o as S,w as k,j as x,i as p,k as W}from"./BH4CL5cc.js";import{u as I}from"./B-qXnbMs.js";import{P as _}from"./DGROana5.js";const A="dismissableLayer.pointerDownOutside",z="dismissableLayer.focusOutside";function C(r,t){const i=t.closest("[data-dismissable-layer]"),s=r.dataset.dismissableLayer===""?r:r.querySelector("[data-dismissable-layer]"),a=Array.from(r.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(i&&s===i||a.indexOf(s)<a.indexOf(i))}function R(r,t){var n;const i=((n=t==null?void 0:t.value)==null?void 0:n.ownerDocument)??(globalThis==null?void 0:globalThis.document),s=m(!1),a=m(()=>{});return O(d=>{if(!b)return;const o=async c=>{const D=c.target;if(t!=null&&t.value){if(C(t.value,D)){s.value=!1;return}if(c.target&&!s.value){let w=function(){L(A,r,E)};const E={originalEvent:c};c.pointerType==="touch"?(i.removeEventListener("click",a.value),a.value=w,i.addEventListener("click",a.value,{once:!0})):w()}else i.removeEventListener("click",a.value);s.value=!1}},f=window.setTimeout(()=>{i.addEventListener("pointerdown",o)},0);d(()=>{window.clearTimeout(f),i.removeEventListener("pointerdown",o),i.removeEventListener("click",a.value)})}),{onPointerDownCapture:()=>s.value=!0}}function U(r,t){var a;const i=((a=t==null?void 0:t.value)==null?void 0:a.ownerDocument)??(globalThis==null?void 0:globalThis.document),s=m(!1);return O(n=>{if(!b)return;const d=async o=>{t!=null&&t.value&&(await h(),await h(),!(!t.value||C(t.value,o.target))&&o.target&&!s.value&&L(z,r,{originalEvent:o}))};i.addEventListener("focusin",d),n(()=>i.removeEventListener("focusin",d))}),{onFocusCapture:()=>s.value=!0,onBlurCapture:()=>s.value=!1}}const l=T({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),j=B({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(r,{emit:t}){const i=r,s=t,{forwardRef:a,currentElement:n}=I(),d=y(()=>{var e;return((e=n.value)==null?void 0:e.ownerDocument)??globalThis.document}),o=y(()=>l.layersRoot),f=y(()=>n.value?Array.from(o.value).indexOf(n.value):-1),c=y(()=>l.layersWithOutsidePointerEventsDisabled.size>0),D=y(()=>{const e=Array.from(o.value),[v]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),u=e.indexOf(v);return f.value>=u}),w=R(async e=>{const v=[...l.branches].some(u=>u==null?void 0:u.contains(e.target));!D.value||v||(s("pointerDownOutside",e),s("interactOutside",e),await h(),e.defaultPrevented||s("dismiss"))},n),E=U(e=>{[...l.branches].some(u=>u==null?void 0:u.contains(e.target))||(s("focusOutside",e),s("interactOutside",e),e.defaultPrevented||s("dismiss"))},n);g("Escape",e=>{f.value===o.value.size-1&&(s("escapeKeyDown",e),e.defaultPrevented||s("dismiss"))});let P;return O(e=>{n.value&&(i.disableOutsidePointerEvents&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(P=d.value.body.style.pointerEvents,d.value.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(n.value)),o.value.add(n.value),e(()=>{i.disableOutsidePointerEvents&&l.layersWithOutsidePointerEventsDisabled.size===1&&(d.value.body.style.pointerEvents=P)}))}),O(e=>{e(()=>{n.value&&(o.value.delete(n.value),l.layersWithOutsidePointerEventsDisabled.delete(n.value))})}),(e,v)=>(S(),F(p(_),{ref:p(a),"as-child":e.asChild,as:e.as,"data-dismissable-layer":"",style:W({pointerEvents:c.value?D.value?"auto":"none":void 0}),onFocusCapture:p(E).onFocusCapture,onBlurCapture:p(E).onBlurCapture,onPointerdownCapture:p(w).onPointerDownCapture},{default:k(()=>[x(e.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}});export{j as _,l as c};
